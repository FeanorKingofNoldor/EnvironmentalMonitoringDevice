[platformio]
default_envs = esp32-s3-devkitc-1
src_dir = src
include_dir = include
lib_dir = lib
data_dir = data

[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Serial Monitor Configuration
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    time

; Build Configuration
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DDEVICE_TYPE_ENVIRONMENT
    -DARDUINOJSON_USE_LONG_LONG=1
    -DARDUINOJSON_USE_DOUBLE=1
    -DCONFIG_FREERTOS_UNICORE=0
    -DCONFIG_ARDUINO_LOOP_STACK_SIZE=16384
    -Os
    -Wall
    -std=gnu++17
    -fexceptions

; Partition Scheme for LittleFS
board_build.partitions = custom_partitions.csv
board_build.filesystem = littlefs

; Library Dependencies
lib_deps = 
    bblanchon/ArduinoJson@^7.0.0
    ottowinter/ESPAsyncWebServer-esphome@^3.1.0
    me-no-dev/AsyncTCP@^1.1.1

; Advanced Build Settings
build_unflags = 
    -std=gnu++11

; Upload Configuration
upload_speed = 921600
upload_port = AUTO

; Debug Configuration
debug_tool = esp-builtin
debug_init_break = tbreak setup

[env:production]
; Production environment with optimizations
extends = env:esp32-s3-devkitc-1

build_type = release
build_flags = 
    ${env:esp32-s3-devkitc-1.build_flags}
    -DNDEBUG
    -DCORE_DEBUG_LEVEL=0
    -O2

monitor_filters = 

[env:debug]
; Debug environment with extra debugging
extends = env:esp32-s3-devkitc-1

build_type = debug
build_flags = 
    ${env:esp32-s3-devkitc-1.build_flags}
    -DDEBUG=1
    -DCORE_DEBUG_LEVEL=5
    -g
    -Og

debug_tool = esp-builtin
debug_init_break = tbreak setup

; Build Scripts
extra_scripts = 
    pre:scripts/pre_build.py
    post:scripts/post_build.py